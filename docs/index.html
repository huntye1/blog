<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.65">
<title data-react-helmet="true">开始之前 | 小明的杂货铺</title><meta data-react-helmet="true" name="docsearch:version" content="current,latest"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="开始之前 | 小明的杂货铺"><meta data-react-helmet="true" name="description" content="Vue3 带来的新东西"><meta data-react-helmet="true" property="og:description" content="Vue3 带来的新东西"><meta data-react-helmet="true" property="og:url" content="https://huntye1.github.io/blog/docs/"><link data-react-helmet="true" rel="shortcut icon" href="/blog/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://huntye1.github.io/blog/docs/"><link rel="stylesheet" href="/blog/styles.344e0483.css">
<link rel="preload" href="/blog/styles.62349eb2.js" as="script">
<link rel="preload" href="/blog/runtime~main.6761d61c.js" as="script">
<link rel="preload" href="/blog/main.4f31d0bc.js" as="script">
<link rel="preload" href="/blog/common.35d7c4c7.js" as="script">
<link rel="preload" href="/blog/2.5a81fd3c.js" as="script">
<link rel="preload" href="/blog/14.09725b60.js" as="script">
<link rel="preload" href="/blog/15.ed5d084d.js" as="script">
<link rel="preload" href="/blog/935f2afb.3d5037e6.js" as="script">
<link rel="preload" href="/blog/17896441.94fed1e3.js" as="script">
<link rel="preload" href="/blog/cb6e4981.1ccecfc8.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/blog/"><img class="navbar__logo" src="/blog/img/logo.svg" alt="My Site Logo"><strong class="navbar__title">My Site</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog/docs/">vue3源码解析</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/huntye1" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2aTZ"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_BsTx">🌜</span></div><div class="react-toggle-track-x"><span class="toggle_BsTx">🌞</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/blog/"><img class="navbar__logo" src="/blog/img/logo.svg" alt="My Site Logo"><strong class="navbar__title">My Site</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/blog/docs/">vue3源码解析</a></li><li class="menu__list-item"><a href="https://github.com/huntye1" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_2gpo"><div class="docSidebarContainer_3_JD" role="complementary"><div class="sidebar_2urC"><div class="menu menu--responsive menu_5FrY"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_Dm3K" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" href="/blog/docs/">开始之前</a></li><li class="menu__list-item"><a class="menu__link" href="/blog/docs/vue3源码系列/vue_doc1">响应式原理篇</a></li></ul></div></div></div><main class="docMainContainer_3EyW"><div class="container padding-vert--lg docItemWrapper_1EkI"><div class="row"><div class="col docItemCol_2ASc"><div class="docItemContainer_3QWW"><article><header><h1 class="docTitle_1Lrw">开始之前</h1></header><div class="markdown"><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="vue3-带来的新东西"></a>Vue3 带来的新东西<a aria-hidden="true" tabindex="-1" class="hash-link" href="#vue3-带来的新东西" title="Direct link to heading">#</a></h2><p>2020 年 9 月，Vue3 的正式版发布了。vue3 保留了大量 2.0 的 api，所以从 2.0 迁移到 3.0 几乎很轻松。简单的说说其亮点：</p><table><thead><tr><th>特性</th><th>解析</th></tr></thead><tbody><tr><td>Performance</td><td>性能上比 Vue2.0 块 1.3 ～ 2 倍</td></tr><tr><td>Tree shaking support</td><td>按需编译，编译后体积更小</td></tr><tr><td>Composition API</td><td>参考 React Hook 设计的 API，相对来说逻辑更加容易复用</td></tr><tr><td>Better TypeScript support</td><td>由于源码直接由 TS 写的，所以对 TS 有更好的支持</td></tr><tr><td>Custom Renderer API</td><td>暴露了自定义渲染的 API</td></tr><tr><td>Fragment,Teleport(Protal),Suspense</td><td>更多先进的特性</td></tr></tbody></table><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="性能"></a>性能<a aria-hidden="true" tabindex="-1" class="hash-link" href="#性能" title="Direct link to heading">#</a></h3><ul><li>重写了虚拟 DOM 的实现</li><li>编译模版优化（静态节点不会转为节点对象）</li><li>初始化组件更加高效</li><li>性能提高 1.3 ～ 2 倍</li><li>SSR 性能 2 ～ 3 倍</li></ul><p><img src="https://cdn.jsdelivr.net/gh/huntye1/gallery@master/image-20201010181225607.png" alt="image-20201010181225607"></p><p><a href="https://vue-next-template-explorer.netlify.com/" target="_blank" rel="noopener noreferrer">模版编译优化</a>：静态节点会被标记，不会在 diff 中比较以及重新渲染。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="tree-shaking"></a>Tree shaking<a aria-hidden="true" tabindex="-1" class="hash-link" href="#tree-shaking" title="Direct link to heading">#</a></h3><ul><li>HelloWorld 例子大小减小到 13.5kb<ul><li>使用 composition API 仅有 11.75kb</li></ul></li><li>包含所有运行态 22.5kb<ul><li>比 Vue2 体积更小，功能更小</li></ul></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="compisition-api"></a>Compisition API<a aria-hidden="true" tabindex="-1" class="hash-link" href="#compisition-api" title="Direct link to heading">#</a></h3><ul><li>兼容现在的 options API（实际上就是提供 setup 选项）</li><li>逻辑更加复用</li><li>Reactivity 模块可以单独使用，搭配其他框架。</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="fragments，teleport，suspense"></a>Fragments，Teleport，Suspense<a aria-hidden="true" tabindex="-1" class="hash-link" href="#fragments，teleport，suspense" title="Direct link to heading">#</a></h3><ul><li>Fragments 不再限制单根节点，可以不用包一层了。</li><li>Teleport 跟 React 类似，组件层面保持原有位置，DOM 渲染可以渲染到另外的地方。</li><li>Supspense 支持异步渲染，使用支持 async setup()及 Async Components。</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="更好的-typescript-支持"></a>更好的 TypeScript 支持<a aria-hidden="true" tabindex="-1" class="hash-link" href="#更好的-typescript-支持" title="Direct link to heading">#</a></h3><ul><li>源代码使用 TS 书写，自动生成类型定义（不用单独维护了）</li><li>SFC 的 templete 中属性也支持类型校验了。</li><li>支持 TSX</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="自定义渲染-api"></a>自定义渲染 API<a aria-hidden="true" tabindex="-1" class="hash-link" href="#自定义渲染-api" title="Direct link to heading">#</a></h3><ul><li>可以渲染在不同的平台上。（得益于 Vue 的功能分块，可以单独使用其中的一部分包）</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="阅读-vue3-源码"></a>阅读 Vue3 源码<a aria-hidden="true" tabindex="-1" class="hash-link" href="#阅读-vue3-源码" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="为什么阅读源码？"></a>为什么阅读源码？<a aria-hidden="true" tabindex="-1" class="hash-link" href="#为什么阅读源码？" title="Direct link to heading">#</a></h3><blockquote><p>如果说写代码是表达自己，那么阅读代码就是理解别人。理解别人犹如学习别人的思想，学习优秀的思想提高自己的思想能力，从而提高编程水平。</p></blockquote><p>两个字：<b>学习</b>。</p><p>跳出自己的思维，学习别人的思想。</p><p>从内容上讲，学习设计模式，学习代码组织，学习数据结构，学习成熟的解决方案......</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="如何阅读源码？"></a>如何阅读源码？<a aria-hidden="true" tabindex="-1" class="hash-link" href="#如何阅读源码？" title="Direct link to heading">#</a></h3><p>参考：<a href="https://www.zhihu.com/question/19625320" target="_blank" rel="noopener noreferrer">如何阅读源码？</a></p><p>总结一下：</p><ul><li><p>需要预先了解代码的背景，基本思想，基本方案.......即需要解决的问题和解决的方案。</p></li><li><p>主动思考</p><ul><li>如果自己会怎么写：正向推导 + 验证</li><li>改写代码以及 debug 调试代码</li></ul></li><li><p>整体把握，各个击破。理解整体的流程，忽略细节。重点理解重点部分的模块代码，各个击破。</p></li><li><p>理清思路输出。最好带有目的阅读，回答大脑的问题，输出答案，防止大脑觉得&quot;懂了&quot;。</p></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="开始阅读"></a>开始阅读<a aria-hidden="true" tabindex="-1" class="hash-link" href="#开始阅读" title="Direct link to heading">#</a></h3><p>首先去 github fork 一份 vue3 源码，fork 一份的好处是随时自己修改代码或者添加一些注释。</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="分析目录结构"></a>分析目录结构<a aria-hidden="true" tabindex="-1" class="hash-link" href="#分析目录结构" title="Direct link to heading">#</a></h4><p><img src="https://cdn.jsdelivr.net/gh/huntye1/gallery@master/image-20201010210655403.png" alt="image-20201010210655403"></p><blockquote><p>来自.github/contributing.md</p></blockquote><p>重点分析 packages 目录，可以看到这里面根据功能划分出了很多包。vue3 使用的是<a href="https://en.wikipedia.org/wiki/Monorepo" target="_blank" rel="noopener noreferrer">monorepo</a> 的能力把多个有关联的包组织在一个 package 目录下面，下面分别分析每个目录（包）：</p><ul><li><code>reactivity</code>：响应式系统，可以作为一个单独的包来使用（跨框架）。</li><li><code>runtime-core</code>：跨平台的运行时核心组件，代码包括：虚拟 dom 的渲染器，组件的实现，Javascript 的相关 API。可以使用这个包来创建跨平台的的高级运行时（如自定义渲染器）。</li><li><code>runtime-dom</code>：针对浏览器的运行时，包括处理原生 DOM API、 attributes, properties、事件处理等。</li><li><code>runtime-test</code>：用于测试的轻量级运行时，由于它渲染出的树是一个纯 JS 对象，所以可以用在任何 JS 环境。这棵树可以用于确定正确的渲染输出，也包括了一些工具如序列化树，触发事件，和记录在更新期间执行的实际节点操作。</li><li><code>server-renderer</code>：用于服务端渲染。</li><li><code>compiler-core</code>：跨平台的编译器核心（<code>compiler-core</code>）。包括有可扩展能力的编译器以及跨平台的插件。</li><li><code>compiler-dom</code>：带有针对浏览器特殊插件的编译器。</li><li><code>compiler-ssr</code>：编译器，可以生成为服务器端渲染而专门优化的渲染函数。</li><li><code>compiler-sfc</code>：基础工具用于解析 Vue 单文件组件。为了灵活性，故意把暴露得 API 设计很简单（lower level）。</li><li><code>template-explorer</code>：开发编译器触发的<a href="https://vue-next-template-explorer.netlify.com/" target="_blank" rel="noopener noreferrer">开发工具</a>。</li><li><code>shared</code>：多个包共享的一些工具（特别是运行时和编译时和环境无关的）</li><li><code>vue</code>：面向完全构建的公共包，包括运行时和解析器。</li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="各模块的依赖关系"></a>各模块的依赖关系<a aria-hidden="true" tabindex="-1" class="hash-link" href="#各模块的依赖关系" title="Direct link to heading">#</a></h4><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">                                    +---------------------+</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                                    |                     |</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                                    |  @vue/compiler-sfc  |</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                                    |                     |</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                                    +-----+--------+------+</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                                          |        |</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                                          v        v</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                      +---------------------+    +----------------------+</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                      |                     |    |                      |</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        +------------&gt;|  @vue/compiler-dom  +---&gt;|  @vue/compiler-core  |</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        |             |                     |    |                      |</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   +----+----+        +---------------------+    +----------------------+</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   |         |</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   |   vue   |</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   |         |</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   +----+----+        +---------------------+    +----------------------+    +-------------------+</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        |             |                     |    |                      |    |                   |</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        +------------&gt;|  @vue/runtime-dom   +---&gt;|  @vue/runtime-core   +---&gt;|  @vue/reactivity  |</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                      |                     |    |                      |    |                   |</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                      +---------------------+    +----------------------+    +-------------------+</span></div></div></div></div></div></div></article><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/blog/docs/vue3源码系列/vue_doc1"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">响应式原理篇 »</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_3SO_"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#vue3-带来的新东西" class="table-of-contents__link">Vue3 带来的新东西</a><ul><li><a href="#性能" class="table-of-contents__link">性能</a></li><li><a href="#tree-shaking" class="table-of-contents__link">Tree shaking</a></li><li><a href="#compisition-api" class="table-of-contents__link">Compisition API</a></li><li><a href="#fragments，teleport，suspense" class="table-of-contents__link">Fragments，Teleport，Suspense</a></li><li><a href="#更好的-typescript-支持" class="table-of-contents__link">更好的 TypeScript 支持</a></li><li><a href="#自定义渲染-api" class="table-of-contents__link">自定义渲染 API</a></li></ul></li><li><a href="#阅读-vue3-源码" class="table-of-contents__link">阅读 Vue3 源码</a><ul><li><a href="#为什么阅读源码？" class="table-of-contents__link">为什么阅读源码？</a></li><li><a href="#如何阅读源码？" class="table-of-contents__link">如何阅读源码？</a></li><li><a href="#开始阅读" class="table-of-contents__link">开始阅读</a></li></ul></li></ul></div></div></div></div></main></div></div></div>
<script src="/blog/styles.62349eb2.js"></script>
<script src="/blog/runtime~main.6761d61c.js"></script>
<script src="/blog/main.4f31d0bc.js"></script>
<script src="/blog/common.35d7c4c7.js"></script>
<script src="/blog/2.5a81fd3c.js"></script>
<script src="/blog/14.09725b60.js"></script>
<script src="/blog/15.ed5d084d.js"></script>
<script src="/blog/935f2afb.3d5037e6.js"></script>
<script src="/blog/17896441.94fed1e3.js"></script>
<script src="/blog/cb6e4981.1ccecfc8.js"></script>
</body>
</html>